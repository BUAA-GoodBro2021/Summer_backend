<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div>
    <input type="text" placeholder="请输入" id="txt" oninput="tagChange()">
</div>

<script>
    {#握手socket#}
    socket = new WebSocket("wss://101.42.224.73:8003/wss/{{ page_id }}/");
    {#获取对应文本框#}
    let tag = document.getElementById("txt");
    socket.onmessage = function (event) {
        console.log(event.data);
        let page_dict = event.data;
        let page_name = JSON.parse(page_dict)['page_name'];
        console.log(page_name);
    }
    let dict = {"page_id": 206, "page_name": "\u65b0\u5efa\u9875\u97621", "page_height": 400.0, "page_width": 400.0, "element_list": "", "num": 0, "created_time": "2022-08-07 10:38:56.333834", "updated_time": "2022-08-07 10:38:56.333877"};
    setTimeout(function (){
        socket.send(JSON.stringify(dict))
    }, 200);
    {#设置同步#}
{#    let mutex = 0;#}
    {#当每半秒写完时，接收发送信息#}
{#    socket.onmessage = function (event) {#}
{#        if(mutex === 0) {#}
{#            tag.value = event.data;#}
{#        }#}
{#    }#}
    {#当文本框更新时，禁止其他客户端接收信息，向服务端发送更新信息，延时覆盖#}
{#    tagChange = function () {#}
{#        if(mutex === 0) {#}
{#            mutex = 1;#}
{#            setTimeout(function (){#}
{#                socket.send(tag.value)#}
                {#覆盖完成后恢复#}
{#                mutex = 0;#}
{#            }, 200);#}
{#        }#}
{#    };#}
</script>

</body>
</html>